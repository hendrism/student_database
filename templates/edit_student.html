{% extends "base.html" %}
{% block title %}Edit Student{% endblock %}
{% block content %}
<h2>Edit Student: {{ student.first_name }} {{ student.last_name }}</h2>

<form method="POST">
  <!-- Student Personal Info -->
  {% include "_student_form_fields.html" %}
  <a href="{{ url_for('routes.add_goal', student_id=student.student_id) }}"
     class="btn btn-success mb-3">
    Add New Goal
  </a>
  
  <!-- Goals & Objectives Table -->
  <h3 class="mt-5">Goals &amp; Objectives</h3>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Goal</th>
        <th>Objectives</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for goal in student.goals if goal.active %}
      <tr>
        <td>{{ goal.goal_description }}</td>
        <td>
          <ul class="mb-0">
            {% for obj in goal.objectives if obj.active %}
            <li>{{ obj.objective_description }}</li>
            {% endfor %}
          </ul>
        </td>
        <td>
          <!-- Edit Goal -->
          <a href="{{ url_for('routes.edit_goal', goal_id=goal.goal_id) }}"
             class="btn btn-sm btn-outline-primary mb-1">Edit Goal</a>
          <!-- Archive Goal -->
          <form method="POST"
                action="{{ url_for('routes.archive_goal', goal_id=goal.goal_id) }}"
                style="display:inline;"
                onsubmit="return confirm('Archive this goal and its objectives?');">
            <button class="btn btn-sm btn-warning mb-1">Archive</button>
          </form>
          <!-- Delete Goal -->
          <form method="POST"
                action="{{ url_for('routes.delete_goal', goal_id=goal.goal_id) }}"
                style="display:inline;"
                onsubmit="return confirm('Delete this goal and its objectives?');">
            <button class="btn btn-sm btn-danger mb-1">Delete</button>
          </form>
          <br/>
          <!-- Add Objective -->
          <a href="{{ url_for('routes.add_objective', goal_id=goal.goal_id) }}"
             class="btn btn-sm btn-outline-success">Add Objective</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  
  <!-- Form Actions -->
  <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
  <a href="{{ url_for('routes.index') }}" class="btn btn-secondary mt-3 ml-2">Cancel</a>
</form>
{% endblock %}
