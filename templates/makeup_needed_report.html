{% extends "base.html" %}
{% block content %}
<h2>Missed/Makeup Needed Sessions Report</h2>

<h3>This Month's Makeup Needed Sessions ({{ current_month }}/{{ current_year }})</h3>
{% if this_month_makeup_needed %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Date</th>
        <th>Student</th>
        <th>Time</th>
        <th>Status</th>
        <th>Plan Notes</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for session in this_month_makeup_needed %}
        <tr>
          <td>{{ session.date_of_session }}</td>
          <td>{{ session.student.first_name }} {{ session.student.last_name }}</td>
          <td>{{ session.time_of_session or 'N/A' }}</td>
          <td>{{ session.status }}</td>
          <td>{{ session.plan_notes or 'N/A' }}</td>
          <td>
            <a href="{{ url_for('routes.edit_session', session_id=session.session_id, next=request.url) }}" class="btn btn-sm btn-primary">Edit</a>
            <form action="{{ url_for('routes.archive_session', session_id=session.session_id) }}" method="post" style="display:inline;">
              <input type="hidden" name="next" value="{{ request.url }}">
              <button type="submit" onclick="return confirmArchive()" class="btn btn-sm btn-warning">Archive</button>
            </form>
            <form action="{{ url_for('routes.delete_session', session_id=session.session_id) }}" method="post" style="display:inline;">
              <input type="hidden" name="next" value="{{ request.url }}">
              <button type="submit" onclick="return confirmDelete()" class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No makeup sessions for this month.</p>
{% endif %}

<h3>All-Time Makeup Needed Sessions</h3>
{% if all_makeup_needed %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Date</th>
        <th>Student</th>
        <th>Time</th>
        <th>Status</th>
        <th>Plan Notes</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for session in all_makeup_needed %}
        <tr>
          <td>{{ session.date_of_session }}</td>
          <td>{{ session.student.first_name }} {{ session.student.last_name }}</td>
          <td>{{ session.time_of_session or 'N/A' }}</td>
          <td>{{ session.status }}</td>
          <td>{{ session.plan_notes or 'N/A' }}</td>
          <td>
            <a href="{{ url_for('routes.edit_session', session_id=session.session_id, next=request.url) }}" class="btn btn-sm btn-primary">Edit</a>
            <form action="{{ url_for('routes.archive_session', session_id=session.session_id) }}" method="post" style="display:inline;">
              <input type="hidden" name="next" value="{{ request.url }}">
              <button type="submit" onclick="return confirmArchive()" class="btn btn-sm btn-warning">Archive</button>
            </form>
            <form action="{{ url_for('routes.delete_session', session_id=session.session_id) }}" method="post" style="display:inline;">
              <input type="hidden" name="next" value="{{ request.url }}">
              <button type="submit" onclick="return confirmDelete()" class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No active makeup sessions on record.</p>
{% endif %}

{% endblock %}
