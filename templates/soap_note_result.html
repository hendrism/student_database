{% extends "base.html" %}
{% block content %}
<h2>Generated SOAP Note</h2>

<!-- S Section -->
<h4>S:</h4>
<textarea id="s_note" class="form-control" rows="4">{{ s_note }}</textarea>
<button id="copy_s" onclick="copyToClipboard('s_note', 'copy_s')" class="btn btn-sm btn-outline-primary">Copy S</button>

<!-- O Section -->
<h4>O:</h4>
<textarea id="o_note" class="form-control" rows="4">{{ o_note }}</textarea>
<button id="copy_o" onclick="copyToClipboard('o_note', 'copy_o')" class="btn btn-sm btn-outline-primary">Copy O</button>

<!-- A Section -->
<h4>A:</h4>
<textarea id="a_note" class="form-control" rows="4">{{ a_note }}</textarea>
<button id="copy_a" onclick="copyToClipboard('a_note', 'copy_a')" class="btn btn-sm btn-outline-primary">Copy A</button>


<!-- P Section -->
<h4>P:</h4>
<textarea id="p_note" class="form-control" rows="4">{{ p_note }}</textarea>
<button id="copy_p" onclick="copyToClipboard('p_note', 'copy_p')" class="btn btn-sm btn-outline-primary">Copy P</button>

<!-- Add to Database Button -->
<form id="addSoapForm" method="POST" action="{{ url_for('routes.add_soap_note') }}" class="mt-3">
  <input type="hidden" name="student_id" value="{{ student_id }}">
  <input type="hidden" name="note_date" value="{{ note_date }}">
  <input type="hidden" name="full_note" value="{{ full_note|replace('"','&quot;') }}">
  <button type="submit" class="btn btn-success">Add to Database</button>
</form>
<script>
  document.getElementById('addSoapForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);
    fetch(form.action, {
      method: 'POST',
      body: data,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => {
      if (response.ok) {
        alert('SOAP note saved successfully!');
      } else {
        alert('Error saving SOAP note.');
      }
    })
    .catch(err => {
      alert('Network error.');
    });
  });
</script>

<!-- Back Button -->
<a href="{{ url_for('routes.soap_note') }}" class="btn btn-secondary mt-4">Generate Another Note</a>

<script>
    function copyToClipboard(elementId, buttonId) {
        const text = document.getElementById(elementId).value;
        navigator.clipboard.writeText(text).then(function() {
            // Show "Copied!" message next to button
            const button = document.getElementById(buttonId);
            const msg = document.createElement('span');
            msg.innerText = ' Copied!';
            msg.style.color = 'green';
            msg.style.marginLeft = '10px';
            button.parentNode.appendChild(msg);
            
            // Remove message after 2 seconds
            setTimeout(() => msg.remove(), 2000);
        }, function(err) {
            console.error('Failed to copy: ', err);
        });
    }
</script>
{% endblock %}
