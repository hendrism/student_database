{% extends "base.html" %}
{% block content %}
<h2>Trial Log</h2>

<!-- Student Selection Form (GET) -->
<form method="GET">
  <div class="form-group">
    <label for="student_id">Select Student:</label>
    <select class="form-control" name="student_id" id="student_id" onchange="this.form.submit()" required>
      <option value="">-- Select a Student --</option>
      {% for student in students %}
        <option value="{{ student.student_id }}" {% if student.student_id|string == selected_student_id %}selected{% endif %}>
          {{ student.first_name }} {{ student.last_name }}
        </option>
      {% endfor %}
    </select>
  </div>
</form>

<!-- Trial Logging Form (POST) -->
{% if selected_student_id %}
  {% if objectives %}
    <form method="POST">
      <!-- Hidden input to keep student_id when submitting trial log -->
      <input type="hidden" name="student_id" value="{{ selected_student_id }}">
      
      <!-- Date of Session -->
      <div class="form-group">
        <label for="date_of_session">Date of Session:</label>
        <input type="date" class="form-control" name="date_of_session" value="{{ today }}" required>
      </div>

      <!-- Objective Selection -->
      <div class="form-group">
        <label for="objective_ids">Select Objective(s):</label>
        {% for obj in objectives %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="objective_ids" value="{{ obj.objective_id }}" id="objective{{ obj.objective_id }}">
            <label class="form-check-label" for="objective{{ obj.objective_id }}">
              {{ obj.objective_description }}
            </label>
          </div>
        {% endfor %}
      </div>

      <!-- Trial Counts -->
      <h4>Trial Counts</h4>
      <div class="form-group">
        <label>Correct - No Support:</label>
        <input type="number" name="correct_no_support" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Correct - Visual Cue:</label>
        <input type="number" name="correct_visual_cue" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Correct - Verbal Cue:</label>
        <input type="number" name="correct_verbal_cue" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Correct - Visual + Verbal Cue:</label>
        <input type="number" name="correct_visual_verbal_cue" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Correct - Modeling:</label>
        <input type="number" name="correct_modeling" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Incorrect:</label>
        <input type="number" name="incorrect" class="form-control" min="0" value="0">
      </div>

      <!-- Notes -->
      <div class="form-group">
        <label>Session Notes (optional):</label>
        <textarea name="notes" class="form-control" rows="3"></textarea>
      </div>

      <!-- Submit -->
      <button type="submit" class="btn btn-primary">Submit Trial Log</button>
    </form>
  {% else %}
    <p>No active objectives found for this student. You may need to add some first.</p>
  {% endif %}
{% else %}
  <p>Please select a student to view and log objectives.</p>
{% endif %}

{% endblock %}