{% extends "base.html" %}
<!-- Trial log page for recording and submitting session trial data for selected objectives. -->
{% block content %}
<h2>Trial Log</h2>

<!-- Student Selection Form (GET) -->
<form method="GET">
  <div class="form-group">
    <label for="student_id">Select Student:</label>
    <select class="form-control" name="student_id" id="student_id" onchange="this.form.submit()" required>
      <option value="">-- Select a Student --</option>
      {% for student in students %}
        <option value="{{ student.student_id }}" {% if student.student_id|string == selected_student_id %}selected{% endif %}>
          {{ student.first_name }} {{ student.last_name }}
        </option>
      {% endfor %}
    </select>
  </div>
</form>

<!-- Trial Logging Form (POST) -->
{% if selected_student_id %}
  {% if objectives %}
    <form method="POST">
      <!-- Hidden input to keep student_id when submitting trial log -->
      <input type="hidden" name="student_id" value="{{ selected_student_id }}">
      
      <!-- Date of Session -->
      <div class="form-group">
        <label for="date_of_session">Date of Session:</label>
        <input type="date" class="form-control" name="date_of_session" value="{{ today }}" required>
      </div>

      <!-- Objective Selection -->
      <div class="form-group">
        <label for="objective_ids">Select Objective(s):</label>
        {% for obj in objectives %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="objective_ids" value="{{ obj.objective_id }}" id="objective{{ obj.objective_id }}">
            <label class="form-check-label" for="objective{{ obj.objective_id }}">
              {{ obj.objective_description }}
            </label>
          </div>
        {% endfor %}
      </div>

      <!-- Trial Counts -->
      <h4>Trial Counts</h4>
      <div class="form-group">
        <label>Independent:</label>
        <input type="number" name="independent" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Minimal Support:</label>
        <input type="number" name="minimal_support" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Moderate Support:</label>
        <input type="number" name="moderate_support" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Maximal Support:</label>
        <input type="number" name="maximal_support" class="form-control" min="0" value="0">
      </div>
      <div class="form-group">
        <label>Incorrect:</label>
        <input type="number" name="incorrect_new" class="form-control" min="0" value="0">
      </div>

      <!-- Visual Cues -->
      <div class="form-group">
        <label>Visual Cues (Select all that apply):</label><br>
        {% for cue in [
          'graphic organizer',
          'written answer choices',
          'written clues',
          'picture choices',
          'sentence starters',
          'sentence starters with pictures',
          'pictures for each word in sentence',
          'written instructions',
          'visual to support instructions',
          'word bank',
          'highlighted text excerpts',
          'color-coded text',
          'step-by-step diagrams',
          'flowcharts',
          'video demonstrations',
          'timers/visual timers',
          'manipulatives'
        ] %}
          <input type="checkbox" name="visual_cues" value="{{ cue }}"> {{ cue }}<br>
        {% endfor %}
        <input type="text" name="visual_cues_other" class="form-control mt-2" placeholder="Other (if applicable)">
      </div>

      <!-- Verbal Cues -->
      <div class="form-group">
        <label>Verbal Cues (Select all that apply):</label><br>
        {% for cue in [
          'leading questions',
          'verbal hints',
          'verbally presented choices',
          'verbally presented instructions',
          'verbal reminders',
          'repetition of text/excerpt from text',
          'modeling',
          'echo modeling',
          'peer modeling',
          'intonation emphasis',
          'self-monitoring prompts',
          'cloze prompts'
        ] %}
          <input type="checkbox" name="verbal_cues" value="{{ cue }}"> {{ cue }}<br>
        {% endfor %}
        <input type="text" name="verbal_cues_other" class="form-control mt-2" placeholder="Other (if applicable)">
      </div>

      <!-- Notes -->
      <div class="form-group">
        <label>Session Notes (optional):</label>
        <textarea name="notes" class="form-control" rows="3"></textarea>
      </div>

      <!-- Submit -->
      <button type="submit" class="btn btn-primary">Submit Trial Log</button>
    </form>
  {% else %}
    <p>No active objectives found for this student. You may need to add some first.</p>
  {% endif %}
{% else %}
  <p>Please select a student to view and log objectives.</p>
{% endif %}

{% endblock %}
