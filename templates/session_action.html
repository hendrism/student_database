{% extends "base.html" %}
{% block content %}
<h2>Manage Session for {{ student.first_name }} {{ student.last_name }}</h2>

<form method="POST">
  <div class="form-group">
    <label for="status">Session Status:</label>
    <select name="status" id="status" class="form-control" required>
      <option value="Scheduled" {% if session.status == 'Scheduled' %}selected{% endif %}>Scheduled</option>
      <option value="Completed" {% if session.status == 'Completed' %}selected{% endif %}>Completed</option>
      <option value="Excused Absence" {% if session.status == 'Excused Absence' %}selected{% endif %}>Excused Absence</option>
      <option value="Makeup Needed" {% if session.status == 'Makeup Needed' %}selected{% endif %}>Makeup Needed</option>
    </select>
  </div>

  <div class="form-group">
    <label for="plan_notes">Plan Notes:</label>
    <textarea name="plan_notes" id="plan_notes" class="form-control" rows="3">{{ session.plan_notes }}</textarea>
  </div>

  <h4>Objectives for this Session:</h4>
  {% if objectives %}
    <ul>
      {% for obj in objectives %}
        <li>{{ obj.objective_description }} ({{ obj.with_accuracy }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No objectives assigned.</p>
  {% endif %}

  <button type="submit" class="btn btn-success">Update Session</button>
  <a href="{{ url_for('routes.sessions', filter_date=request.args.get('filter_date', '')) }}" class="btn btn-secondary">Cancel</a>
</form>

<hr>

<!-- Links to Trial Log and SOAP Note -->
<h4>Next Steps:</h4>
<a href="{{ url_for('routes.trial_log') }}?student_id={{ student.student_id }}" class="btn btn-info">Enter Trial Data</a>
<a href="{{ url_for('routes.soap_note') }}?student_id={{ student.student_id }}" class="btn btn-info">Generate SOAP Note</a>

<!-- Archive Button -->
<form action="{{ url_for('routes.archive_session', session_id=session.session_id) }}" method="POST" style="display:inline;" onsubmit="return confirmArchive();">
  <button type="submit" class="btn btn-secondary">Archive</button>
</form>

<script>
function confirmArchive() {
  return confirm("Are you sure you want to archive this session? This action cannot be undone.");
}
</script>

{% endblock %}