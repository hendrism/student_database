{% extends 'base.html' %}
{% block title %}Quarterly Report History{% endblock %}
{% block content %}
  <h2>Quarterly Report History</h2>

  <!-- Student and Quarter Selection Form -->
  <form method="GET" action="{{ url_for('routes.quarterly_report_history') }}" class="form-inline mb-3">
    <label for="studentSelect" class="mr-2">Select Student:</label>
    <select id="studentSelect" name="student_id" class="form-control mr-2">
      <option value="">-- All Students --</option>
      {% for student in students %}
        <option value="{{ student.student_id }}"
          {% if selected_student and student.student_id == selected_student.student_id %}selected{% endif %}>
          {{ student.first_name }} {{ student.last_name }}
        </option>
      {% endfor %}
    </select>
    <label for="quarterSelect" class="mr-2">Select Quarter:</label>
    <select id="quarterSelect" name="quarter" class="form-control mr-2">
      <option value="">-- All Quarters --</option>
      {% for q in quarters %}
        <option value="{{ q }}" {% if selected_quarter == q %}selected{% endif %}>{{ q }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">View Reports</button>
  </form>

  {% if reports %}
    <table class="table table-bordered">
      <thead class="thead-light">
        <tr>
          <th>Quarter</th>
          <th>Date Created</th>
          <th>Student</th>
          <th>Report Text</th>
        </tr>
      </thead>
      <tbody>
        {% for report in reports %}
          <tr>
            <td>{{ report.quarter }}</td>
            <td>{{ report.date_created.strftime('%Y-%m-%d') }}</td>
            <td>{{ report.student.first_name }} {{ report.student.last_name }}</td>
            <td style="white-space: pre-wrap;">{{ report.report_text }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No quarterly reports found for the selected filters.</p>
  {% endif %}
{% endblock %}